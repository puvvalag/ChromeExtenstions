<style>
body{
  font-family:Verdana;
background:#FFFFFF;

}

.CenterImage
{
border-top: 1px solid #6A5ACD;
border-left: 2px solid #6A5ACD;
border-right: 2px solid #6A5ACD;
border-bottom: 2px solid #6A5ACD;

}

.DownloadLink
{
font-family:Verdana;
font-size:smaller;
color:#4169E1;
}

.DownloadText
{
text-align:center;
}

.NavImage:hover
{
	background-image: url(rightOn.png);
	width:20px;
	height:20px;
}
.PhotoTitle
{
font-family:Verdana;
font-size:small;
color:#4D4D4D;
}

.PhotoTitleDesc
{
font-family:Verdana;
font-size:xx-small;
color:#999999;
}

.Date
{
font-family:Verdana;
font-size:8pt;
color:#7C7C7C;
}

.AlignRight
{
text-align: right;
}
</style>


<script>
var feedUrl = "http://feeds.nationalgeographic.com/ng/photography/photo-of-the-day/";

var req = new XMLHttpRequest();
var imageText
var itemIndex  = 0;
var MAX_ITEMS = 0;

function main()
{
  req.open("GET",feedUrl,false);
  req.overrideMimeType('text/xml')
  req.onload = Display;
  req.send(null);
}

function Display()
{ 
  var doc = req.responseXML;
  var items = doc.getElementsByTagName("item");
 
  var itemText = items[itemIndex].textContent
  imageText = itemText.slice(itemText.indexOf("<img src="),itemText.indexOf('.jpg"/>'))
  imageText= imageText+'.jpg" />'
  //alert(imageText);
  var myDiv = document.getElementById('myDiv');
  imageText = imageText.substring(imageText.indexOf('http'),imageText.indexOf('" />'));
	
  var imageId = imageText.substring(imageText.lastIndexOf('/')+1,imageText.lastIndexOf('_'));;
   if(MAX_ITEMS == 0) 
	MAX_ITEMS = items.length;

  var title = items[itemIndex].textContent;
  var titleDesc = title;
  var PicDate = title;
  var PhotoBy = title;
  var LnkMainPage = title

  title = title.substr(0, title.indexOf("http"));

var spanTitle = document.getElementById('title');
 spanTitle.innerHTML  = title;

 //titleDesc = titleDesc.substring(titleDesc.indexOf("</b></p>")+10, titleDesc.indexOf("</p>"));
 titleDesc = titleDesc.substring(titleDesc.indexOf("</b></p>"));
  titleDesc = titleDesc.substring(titleDesc.indexOf("<p>")+3);
  titleDesc = titleDesc.substring(0,titleDesc.indexOf("</p>"));
 //alert(titleDesc);
//titleDesc = titleDesc.substr(0,100);

  var pTitleDesc = document.getElementById('titleDesc');
 pTitleDesc.innerHTML  = titleDesc;// +"...";
//alert(imageText);

  var dt = new Date();
  var wallprId = imageId * (dt.getDay() + 7197)

  var imgObj = document.getElementById("imgCenter");
  imgObj.src = imageText;

 PicDate = PicDate.substring(PicDate.indexOf("MediaEnt.rss"), PicDate.indexOf("Photograph"));
 PicDate = PicDate.substring(PicDate.indexOf("/>")+2,PicDate.Length);
 PicDate = PicDate.substr(2,19);

 var spanDate = document.getElementById("Date");
 //spanDate.innerHTML = PicDate;

 PhotoBy = PhotoBy.substring(PhotoBy.indexOf("MediaEnt.rss"), PhotoBy.indexOf("Photograph")+75);
 PhotoBy = PhotoBy.substr(PhotoBy.indexOf("Photograph"),75);
 PhotoBy = PhotoBy.substr(0,PhotoBy.lastIndexOf(","));


 var spanPhotoBy = document.getElementById("photoBy");
 spanPhotoBy.innerHTML = PhotoBy;


  var dwnLink = document.getElementById("aDownloadLink");

	// Old style
	//http://images.nationalgeographic.com/wpf/media-live/photos/000/283/custom/28395_1280x1024-wallpaper-cb1289253003.jpg
	//http://images.nationalgeographic.com/wpf/media-live/photos/000/284/custom/28400_1600x1200-wallpaper-cb204565200.jpg
    //var DownldUrl = "http://images.nationalgeographic.com/wpf/media-live/photos/000/"+imageId.substr(0,3)+"/custom/"+
	//			imageId+"_1600x1200-wallpaper-cb"+wallprId+".jpg"
	
	//New
	//http://images.nationalgeographic.com/wpf/media-live/photos/000/596/cache/midsummer-night-bendiksen_59623_990x742.jpg
	var DownldUrl = "http://images.nationalgeographic.com/wpf/media-live/photos/000/"+imageId.substr(0,3)+"/cache/"+
				imageId.substr(0,5)+"_990x742.jpg"
   dwnLink.onclick = function(){
   chrome.tabs.create({url: DownldUrl, selected: false});
   };

  // chrome.browserAction.setBadgeBackgroundColor({color:[0, 255, 0, 100]});

  //  chrome.browserAction.setBadgeText({text:'2'});


  LnkMainPage = LnkMainPage.substring(LnkMainPage.indexOf("<a")+2,LnkMainPage.indexOf('">'));
  LnkMainPage = LnkMainPage.substring(LnkMainPage.indexOf('="')+2);
  var aMainPagrUrl = document.getElementById("lnkMainPage"); 
  aMainPagrUrl.href = LnkMainPage;
}

function ChageImage(imgId)
{
	image = document.getElementById(imgId);
	if(image.src.indexOf("On.png") > 0)
		image.src = imgId +'.png';
	else
		image.src = imgId+'On.png';
}

function Move(value)
{

	itemIndex = (Number(itemIndex) + Number(value)) > 14 ? 0 : (Number(itemIndex) + Number(value))  ;
	if(itemIndex >= 0)
	Display();
	else
	itemIndex = 0;
}
</script>

<html>
<body class="main" onload="main()"> 
<div id="myDiv">
	<table id="myTable">
	<tr id="tr0">
	 <td> &nbsp; </td>
		<td id = "tdTitle"">
		  <span id="title"  class="PhotoTitle"> </span> <div class="AlignRight"><span id ="Date" class="Date" > </span></div>
			<p id = "titleDesc"  class="PhotoTitleDesc"> </p>
		</td>

		<td> &nbsp; </td>

	</tr>

		<tr  id="tr1">
			
			<td>
			<a id="aPrev">
				<img id="left" onmouseover="ChageImage('left')"
				onmouseout="ChageImage('left')" 
				onclick="Move('-1')" width="20px" height="20px" src="left.png" />
			</a>
			</td>
			
			<td id="tdCenter" class="CenterImage">
				<a id="lnkMainPage" target="_blank" href="#"><img id="imgCenter" width="250px" height="200px" />	</a>		
			</td>
			
			<td  >
			<a id="aNext">
				<img  id="right" onmouseover="ChageImage('right')"
				onmouseout="ChageImage('right')" onclick="Move('1')"
				 width="20px" height="20px" src="right.png" />
			</a>
			</td>
			
		</tr>
		<tr>
			<td colspan="3" class="DownloadText">
			<img src="download.png"/>
			<a id="aDownloadLink" href="#" class="DownloadLink"> Download Wallpaper</a>
			</td>
		</tr>
		<tr>
			<td colspan="3" style="text-align:right;" >
				<span id="photoBy" class="Date"> </span>
			</td>
		</tr>
	</table>
</body>
</html>